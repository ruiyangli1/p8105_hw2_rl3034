---
title: "P8105 Homework 2"
author: "Ruiyang Li"
output: github_document
---

This is my solution to HW2.

```{r setup}
library(readxl)
library(tidyverse)
```

## Problem 1

Read and clean the Mr. Trash Wheel sheet:

```{r}
mr_trash_wheel = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", 
             sheet = "Mr. Trash Wheel", 
             range = cell_cols("A:N"),
             skip = 1) %>% 
  janitor::clean_names() %>%
  drop_na(dumpster) %>% 
  mutate(
    sports_balls = as.integer(round(sports_balls, 0))
  ) 
```


Read and clean precipitation data for 2017 and 2018:

```{r}
precip_2017 = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", 
             sheet = "2017 Precipitation",
             range = "A2:B14") %>% 
  janitor::clean_names() %>%   
  mutate(year = "2017") %>% 
  relocate(year)
  
precip_2018 = 
  read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx", 
             sheet = "2018 Precipitation",
             range = "A2:B14") %>% 
  janitor::clean_names() %>% 
  mutate(year = "2018") %>% 
  relocate(year)
```

Combine precipitation datasets:

```{r}
precip = 
  bind_rows(precip_2017, precip_2018) %>% 
  mutate(month = month.name[month])
```


About these data: 

For the Mr. Trash Wheel dataset, there are `r ncol(mr_trash_wheel)` variables with `r nrow(mr_trash_wheel)` observations. Variables include: `r colnames(mr_trash_wheel)`. Data on `r length(unique(pull(mr_trash_wheel, dumpster)))` dumpsters were collected from `r min(pull(mr_trash_wheel, year))` to `r max(pull(mr_trash_wheel, year))`. The total weight of trash is `r sum(pull(mr_trash_wheel, weight_tons))` tons. These trash was incinerated to provide electricity for `r format(round(sum(pull(mr_trash_wheel, homes_powered)), 0), scientific = F)` Maryland homes. The median number of sports balls in a dumpster is `r median(pull(mr_trash_wheel, sports_balls))`.

For the combined precipitation dataset, there are `r ncol(precip)` variables with `r nrow(precip)` observations. Variables include: `r colnames(precip)`. For example, the total precipitation in 2018 was `r sum(pull(precip_2018, total))` (in). 



## Problem 2 

Read and clean the nyc transit data: 

```{r}
nyc_transit = 
  read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(line:route11, entry, vending, entrance_type, ada) %>% 
  mutate(entry = recode(entry, "YES" = TRUE, "NO" = FALSE))
```

About this dataset: 

The raw NYC transit dataset contains `r ncol(read_csv(file = "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv"))` variables. During the data cleaning process, I first cleaned the variables' names by making them all snake case, then I selected the `r ncol(nyc_transit)` variables of interest: `r colnames(nyc_transit)`, and finally I converted the variable `entry` from character (`YES` vs `NO`) to logical (`TRUE` vs `FALSE`). The resulting dataset has `r ncol(nyc_transit)` variables with dimension `r nrow(nyc_transit)` x `r ncol(nyc_transit)`. Data in this resulting dataset are not tidy. For example, the current 11 route variables can be reduced into one route variable indicating different route numbers. Also, duplicated rows were created from the process of selecting partial columns.  


More about the dataset:

```{r}
nyc_transit_distinct = 
  nyc_transit %>% 
  distinct(line, station_name, .keep_all = TRUE)

perct_by_vending = 
  nyc_transit_distinct %>% 
  filter(entry == TRUE) %>% 
  group_by(vending) %>% 
  summarise(n = n(), .groups = 'drop') %>% 
  mutate(perct = n/sum(n)) 
```

* There are `r nrow(nyc_transit_distinct)` distinct stations. 
* There are `r sum(pull(nyc_transit_distinct, ada))` stations that are ADA compliant. 
* `r round(perct_by_vending[1,3],4)*100`% of station entrances / exits without vending allow entrance. 


Reformat data so that route number and route name are distinct variables: 

```{r}
nyc_transit_reformat = 
  nyc_transit_distinct %>% 
  mutate_at(vars(route8:route11), as.character) %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_number",
    names_prefix = "route",
    values_to = "route_name")

nyc_transit_a = 
  nyc_transit_reformat %>% 
  filter(route_name == "A") %>% 
  distinct(line, station_name, .keep_all = TRUE)
```

* There are `r nrow(nyc_transit_a)` distinct stations serve the A train. 
* Of the stations that serve the A train, `r sum(pull(nyc_transit_a, ada))` are ADA compliant. 



## Problem 3

Clean pols-month.csv: 

```{r}
pols = 
  read_csv("./data/pols-month.csv") %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    month = month.name[as.numeric(month)], 
    prez = ifelse(prez_dem == 1, "dem", ifelse(prez_gop == 1, "gop", "other"))
  ) %>% 
  select(-prez_dem, -prez_gop, -day)
```

Clean snp.csv: 

```{r}
snp = 
  read_csv("./data/snp.csv") %>% 
  separate(date, into = c("month", "day", "year"), sep = "/") %>% 
  mutate(month = month.name[as.numeric(month)]) %>% 
  select(-day) %>% 
  relocate(year)
```

Tidy unemployment.csv: 

```{r}
unemployment = 
  read_csv("./data/unemployment.csv") %>% 
  pivot_longer(
    Jan:Dec,
    names_to = "month", 
    values_to = "unemployment"
  ) %>% 
  janitor::clean_names() %>% 
  mutate(
    month = month.name[match(month, month.abb)],
    year = as.character(year)
  )
```

Merge snp into pols, and merge unemployment into the result: 

```{r}
merge_df = left_join(pols, snp, by = c("year", "month"))

merge_df = left_join(merge_df, unemployment, by = c("year", "month"))
```




